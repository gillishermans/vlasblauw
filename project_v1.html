<!DOCTYPE html>
<html lang="nl">
<link href='https://fonts.googleapis.com/css?family=Roboto Flex' rel='stylesheet'>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Project</title>
  <link rel="stylesheet" href="style.css">
  <style>
    p {
      max-width: 1075px;
       margin: 0px auto 100px auto;
      font-size: 16px;
      line-height: 1;
      color: #333;
      text-align: left;
    }

    button {
      background-color: white;
      color: black;
      font-family: 'Roboto Flex';
      border: none;
      font-size: 16px;
      cursor: pointer;
    }

    .buttons {
      max-width: 1075px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 100px auto 0 auto;
    }

    .project-header {
      max-width: 1075px;
      margin: auto;
      display: flex;
      gap: 12px;
      align-items: baseline;
    }

    .project-header h2 {
      font-size: 24px;
      line-height: 1;
      color: black;
    }

    .project-header #year {
      margin: 0 0 0 8px;
      font-size: 16px;
      line-height: 1;
      color: #666;
    }

    .project-thumbnail {
      max-width: 1075px;
      margin: 12px auto 8px auto;
      max-height: 500px;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .project-thumbnail img {
      max-height: 500px;
      width: auto;
      height: auto;
      display: block;
    }

    .project-gallery {
      max-width: 1075px;
      margin: 20px auto 0px auto;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }

    .project-gallery img {
      width: 100%;
      aspect-ratio: 1;
      height: auto;
      object-fit: cover;
    }
  </style>
</head>

<body>
  <div class="topnav">
    <div class="nav-container">
      <div class="nav-left">
        <ul>
          <li><img class="logo" src="/images/logo_nowhites.jpg" alt="Vlasblauw Logo"></li>
          <li><a href="vlasblauw.html">vlasblauw</a></li>
          <li><a class="active" href="index.html">projects</a></li>
          <li><a href="contact.html">contact</a></li>
        </ul>
      </div>
      <div class="nav-right">
        <ul>
          <li><a href="https://www.instagram.com/vlasblauw/">
              <img class="social" src="images/icons/icons8-instagram-26.png">
            </a></li>
          <li><a href="mailto:vlasblauw@info.be">
              <img class="social" src="images/icons/email-envelope-outline-shape-with-rounded-corners_icon-icons.com_56530.png">
            </a></li>
        </ul>
      </div>
    </div>
  </div>

  <div class="buttons">
    <button id="prev-project" type="button" aria-label="Previous">← previous project</button>
    <button id="next-project" type="button" aria-label="Next" style="padding-right: 15px;">next project
      →</button>
  </div>

  <!-- <div id="project-thumbnail" class="project-thumbnail"></div> -->

  <div id="project-gallery" class="project-gallery"></div>

  <div class="project-header">
    <h2 id="project-title">Project</h2>
    <div id="year">2025</div>
  </div>
  <p id="description">description</p>

  <div class="bottomnav">
    <div class="nav-container">
      <p>info@vlasblauw.be</p>
    </div>
  </div>

  <script>
    (async function () {
      const params = new URLSearchParams(location.search);
      const folder = params.get('folder');
      const titleElement = document.getElementById('project-title');
      const yearElement = document.getElementById('year');
      const descriptionElement = document.getElementById('description');
      //const thumbnailElement = document.getElementById('project-thumbnail');
      const galleryElement = document.getElementById('project-gallery');
      const prevBtn = document.getElementById('prev-project');
      const nextBtn = document.getElementById('next-project');

      if (!folder) {
        galleryElement.innerHTML = '<p>No project specified.</p>';
        return;
      }

      const decodedFolder = decodeURIComponent(folder);

      //Joins the path to form absolute path
      function joinPath(a, b) {
        return String(a).replace(/\/+$/, '') + '/' + String(b).replace(/^\/+/, '');
      }

      //Load full manifest
      let manifest = [];
      try {
        const res = await fetch('./projects.json', { cache: 'no-cache' });
        if (res.ok) manifest = await res.json();
      } catch (e) { manifest = []; }
      const manifestIndex = Array.isArray(manifest)
        ? manifest.findIndex(it =>
          it.folder === decodedFolder ||
          it.title === decodedFolder ||
          (it.href && it.href.replace(/\/$/, '').endsWith(decodedFolder))
        )
        : -1;

      //Get the entry from manifest based on computed index  
      const entry = manifestIndex !== -1 && Array.isArray(manifest) ? manifest[manifestIndex] : null;

      //Setup previous and next buttons
      if (prevBtn && nextBtn) {
        if (manifestIndex > 0) {
          prevBtn.addEventListener('click', () => {
            const target = manifest[manifestIndex - 1];
            location.href = `project.html?folder=${encodeURIComponent(target.folder)}`;
          });
        } else {
          prevBtn.addEventListener('click', () => {
            const target = manifest[manifest.length - 1];
            location.href = `project.html?folder=${encodeURIComponent(target.folder)}`;
          });
        }
        if (manifestIndex !== -1 && manifestIndex < manifest.length - 1) {
          nextBtn.addEventListener('click', () => {
            const target = manifest[manifestIndex + 1];
            location.href = `project.html?folder=${encodeURIComponent(target.folder)}`;
          });
        } else {
          nextBtn.addEventListener('click', () => {
            const target = manifest[0];
            location.href = `project.html?folder=${encodeURIComponent(target.folder)}`;
          });
        }
      }

      //If no entry found in manifest display message
      if (!entry) {
        galleryElement.innerHTML = `<p style="font-style:italic;text-align:center; margin:100px auto auto;>Project "${decodedFolder}" niet gevonden in manifest.</p>`;
        return;
      }

      //Set title/year/description/images from json manifest if available
      titleElement.textContent = entry.title;
      yearElement.textContent = entry.year;
      descriptionElement.textContent = entry.description;
      let images = entry.images;

      //Add project folder path to images if absolute path not specified
      images = images.map(img => {
        img = String(img || '').trim();
        const looksAbsolute = /^\/|^[a-zA-Z]+:\/\//.test(img);
        const hasProjectsPrefix = img.startsWith('projects/');
        if (looksAbsolute || hasProjectsPrefix) {
          return img.replace(/^\/+/, '');
        }
        const base = entry.href || `projects/${entry.folder}/`;
        return joinPath(base, img);
      });

      //If no images found for project display message
      if (!images.length) {
        galleryElement.innerHTML = '<p style="font-style:italic;text-align:center; margin:100px auto auto;">Geen afbeeldingen gevonden voor dit project.</p>';
        return;
      }

      //Add image to thumbnail
      //const src = joinPath(entry.href, entry.thumbnail);
      //const safe = src.replace(/^\/+/, '');
      //thumbnailElement.innerHTML = `<img src="${safe}" alt="">`;

      //Add images to gallery
      galleryElement.innerHTML = images.map(src => {
        const safe = src.replace(/^\/+/, '');
        return `<div class="gallery-item"><img src="${safe}" alt=""></div>`;
      }).join('');
    })();
  </script>
</body>

</html>