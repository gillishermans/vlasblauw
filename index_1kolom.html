<!DOCTYPE html>
<html lang="nl">
<link href='https://fonts.googleapis.com/css?family=Roboto Flex' rel='stylesheet'>

<head>
  <title>Vlasblauw</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" type="text/css" href="style.css">
  <link rel="icon" type="image/png" href="/images/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="/images/favicon.svg" />
  <link rel="shortcut icon" href="/images/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png" />
  <meta name="apple-mobile-web-app-title" content="Vlasblauw" />
  <link rel="manifest" href="/images/site.webmanifest" />
  <style>
    #projects-container {
      display: flex;
      flex-direction: column;
      gap: 40px;
      max-width: 550px;
      margin: 60px auto;
      padding: 0 20px;
    }

    .project {
      border-bottom: 1px solid #ccc;
      padding-bottom: 20px;
    }

    .project-thumbnail {
      position: relative; /* allow nav buttons to sit next to/over the thumbnail */
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .project-thumbnail img {
      max-width: 100%;
      height: auto;
      display: block;
      margin-bottom: 10px;
    }

    /* thumbnail nav buttons */
    .project-thumbnail .thumb-nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(27,44,62,0.9);
      color: #fff;
      border: none;
      width: 36px;
      height: 36px;
      border-radius: 6px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      z-index: 5;
    }
    .project-thumbnail .thumb-prev { left: 8px; }
    .project-thumbnail .thumb-next { right: 8px; }
    .project-thumbnail .thumb-nav[hidden] { display: none !important; }

    .project-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .project-header h2 {
      margin: 0;
      font-size: 1.5em;
    }

    .year {
      font-size: 1em;
      color: #666;
    }

    .project-description {
      font-size: 1em;
      color: #333;
      text-align: justify;
    }
  </style>
</head>

<body>
  <div class="topnav">
    <div class="nav-container">
      <div class="nav-left">
        <ul>
          <li><img class="logo" src="images/logo-nowhites.jpg" alt="Vlasblauw Logo"></li>
          <li><a href="vlasblauw.html">vlasblauw</a></li>
          <li><a class="active" href="#">projecten</a></li>
          <li><a href="contact.html">contact</a></li>
        </ul>
      </div>
      <div class="nav-right">
        <ul>
          <li><a href="https://www.instagram.com/vlasblauw/">
              <img class="social" src="images/icons/icons8-instagram-26.png">
            </a></li>
          <li><a href="mailto:vlasblauw@info.be">
              <img class="social"
                src="images/icons/email-envelope-outline-shape-with-rounded-corners_icon-icons.com_56530.png">
            </a></li>
        </ul>
      </div>
    </div>
  </div>

  <div id="projects-container"></div>

  <div class="bottomnav">
    <div class="nav-container">
      <p>info@vlasblauw.be | +32491047057</p>
    </div>
  </div>

  <script>
    (async function () {
      const container = document.getElementById('projects-container');

      function joinPath(a, b) {
        return String(a).replace(/\/+$/, '') + '/' + String(b).replace(/^\/+/, '');
      }

      function resolveThumb(it) {
        let t = String(it.thumbnail || '').trim();
        const looksAbsolute = /^\/|^[a-zA-Z]+:\/\//.test(t);
        const hasProjectsPrefix = t.startsWith('projects/');
        if (!t) {
          //Fallback to first image of images array if present
          if (Array.isArray(it.images) && it.images.length) t = it.images[0];
        }
        if (!t) return '';
        if (looksAbsolute || hasProjectsPrefix) return t.replace(/^\/+/, '');
        const base = it.href || `projects/${it.folder}/`;
        return joinPath(base, t);
      }

      try {
        const res = await fetch('./projects.json', { cache: 'no-cache' });
        if (!res.ok) throw new Error('projects.json not found');
        const items = await res.json();
        if (!Array.isArray(items) || !items.length) {
          container.innerHTML = '<p style="font-style:italic;text-align:center;margin:60px auto;">Kan projecten niet laden.</p>';
          return;
        }

        //Build DOM for each project
        items.forEach((it) => {
          const projectEl = document.createElement('section');
          projectEl.className = 'project';

          //Thumbnail (linked to project viewer)
          const thumbDiv = document.createElement('div');
          thumbDiv.className = 'project-thumbnail';
          const link = document.createElement('a');
          const folderName = encodeURIComponent(it.folder || (it.href || '').replace(/\/$/, '').split('/').pop() || '');
          link.href = `project_thumbnail.html?folder=${folderName}`;
          const img = document.createElement('img');
          const thumbSrc = resolveThumb(it);
          if (thumbSrc) img.src = thumbSrc;
          img.alt = it.title || it.folder || '';
          link.appendChild(img);
          thumbDiv.appendChild(link);
          
          // Build full images array for this project (resolve relative names)
          const rawImages = Array.isArray(it.images) ? it.images.slice() : [];
          const images = rawImages.map(i => {
            let s = String(i || '').trim();
            if (!s) return '';
            const looksAbsolute = /^\/|^[a-zA-Z]+:\/\//.test(s);
            const hasProjectsPrefix = s.startsWith('projects/');
            if (looksAbsolute || hasProjectsPrefix) return s.replace(/^\/+/, '');
            const base = it.href || `projects/${it.folder}/`;
            return joinPath(base, s);
          }).filter(Boolean);

          //Create prev/next buttons next to the thumbnail to cycle preview image
          const prevBtn = document.createElement('button');
          prevBtn.className = 'thumb-nav thumb-prev';
          prevBtn.type = 'button';
          prevBtn.title = 'Vorige afbeelding';
          prevBtn.textContent = '‹';
          const nextBtn = document.createElement('button');
          nextBtn.className = 'thumb-nav thumb-next';
          nextBtn.type = 'button';
          nextBtn.title = 'Volgende afbeelding';
          nextBtn.textContent = '›';
          //Hide nav if there are no or only one image
          if (images.length <= 1) {
            prevBtn.setAttribute('hidden', '');
            nextBtn.setAttribute('hidden', '');
          }

          //Current index state per project
          let currentIndex = 0;
          //If explicit thumbnail matches an index, set that as initial
          if (it.thumbnail && images.length) {
            const cleanThumb = resolveThumb(it).replace(/^\/+/, '');
            const match = images.findIndex(p => p.replace(/^\/+/, '').endsWith(cleanThumb.split('/').pop()));
            if (match !== -1) currentIndex = match;
          }

          function showIndex(i) {
            if (!images.length) return;
            currentIndex = ((i % images.length) + images.length) % images.length;
            img.src = images[currentIndex].replace(/^\/+/, '');
          }

          prevBtn.addEventListener('click', (e) => {
            e.preventDefault();
            showIndex(currentIndex - 1);
          });
          nextBtn.addEventListener('click', (e) => {
            e.preventDefault();
            showIndex(currentIndex + 1);
          });

          //Append nav buttons inside thumbnail container (so they sit next to the img)
          thumbDiv.appendChild(prevBtn);
          thumbDiv.appendChild(nextBtn);

          //Initialize preview to chosen index (if images available)
          if (images.length) showIndex(currentIndex);

          //Header
          const header = document.createElement('div');
          header.className = 'project-header';
          const h2 = document.createElement('h2');
          h2.textContent = it.title;
          const year = document.createElement('div');
          year.className = 'year';
          year.textContent = it.year;
          header.appendChild(h2);
          header.appendChild(year);

          //Description
          const p = document.createElement('p');
          p.className = 'project-description';
          p.textContent = it.description;

          projectEl.appendChild(thumbDiv);
          projectEl.appendChild(header);
          projectEl.appendChild(p);
          container.appendChild(projectEl);
        });
      } catch (err) {
        console.warn(err);
        container.innerHTML = '<p style="font-style:italic;text-align:center;margin:60px auto;">Kan projecten niet laden.</p>';
      }
    })();
  </script>

</body>

</html>