<!DOCTYPE html>
<html lang="nl">
<link href='https://fonts.googleapis.com/css?family=Roboto Flex' rel='stylesheet'>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Project</title>
  <link rel="stylesheet" href="style.css">
  <style>
    button {
      background-color: white;
      color: black;
      font-family: 'Roboto Flex';
      border: none;
      font-size: 16px;
      cursor: pointer;
    }

    .buttons {
      max-width: 1075px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 125px auto 0 auto;
    }

    .project-top {
      display: inline-block;
    }

    .project-header {
      max-width: 1075px;
      margin: 0px auto 0px auto;
      display: flex;
      gap: 12px;
      align-items: baseline;
      justify-content: space-between;
      position: relative;
    }

    .project-header h2 {
      font-size: 24px;
      line-height: 1;
      color: black;
    }

    .project-description{
      max-width: 1075px;
      margin: 0px auto 20px auto;
    }

    .project-description p {
      max-width: 1075px;
      margin: 0px auto 10px auto;
      font-size: 14px;
      line-height: 1;
      color: #333;
      text-align: left;
    }

    .project-tasks {
      max-width: 1075px;
      margin: 0px auto 0px auto;
      font-size: 12px;
      line-height: 1.4;
      color: #444;
      text-align: left;
      position: relative;
      bottom: 20px;
    }

    .project-header #year {
      margin: 0 0 0 8px;
      font-size: 16px;
      line-height: 1;
      color: #666;
    }

    .credits {
      font-size: 12px;
      line-height: 1.4;
      color: #555;
      text-align: left;
    }

    .project-thumbnail {
      max-width: 1075px;
      margin: 12px auto 0px auto;
      max-height: 650px;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .project-thumbnail .thumb-wrap img {
      max-height: 650px;
      width: auto;
      height: auto;
      display: block;
      margin: 0px auto 0px auto;;
    }

    .project-gallery {
      max-width: 1075px;
      margin: 20px auto 100px auto;
      display: flex;
      flex-direction: column;
      gap: 20px;
      align-items: center;
      justify-content: flex-start;
      box-sizing: border-box;
      padding: 0 12px;
    }

    .project-gallery .gallery-item {
      max-height: 650px;
      max-width: 1075px; 
      width: auto;
      height: auto;
      display: flex;
      justify-content: center;
      box-sizing: border-box;
    }

    .project-gallery .gallery-item img {
      max-height: 650px;
      max-width: 1075px; 
      width: auto;        
      height: auto;             
      display: block;
      object-fit: contain;
    }

    @media (max-width: 600px) {
      .buttons {
        margin: 60px auto 0 auto;
        padding: 0 10px;
      }

      button {
        font-size: 10px;
      }

      .project-thumbnail {
        max-height: 400px;
        margin: 8px auto 8px auto;
      }

      .project-thumbnail .thumb-wrap img {
        max-height: 400px;
      }

    }

  </style>
</head>

<body>
  <div class="topnav">
    <div class="nav-container">
      <div class="nav-left">
        <ul>
          <li><img class="logo" src="images/logo-nowhites.jpg" alt="Vlasblauw Logo"></li>
          <li><a href="vlasblauw.html">vlasblauw</a></li>
          <li><a class="active" href="index.html">projects</a></li>
          <li><a href="contact.html">contact</a></li>
        </ul>
      </div>
      <div class="nav-right">
        <ul>
          <li><a href="https://www.instagram.com/vlasblauw/">
              <img class="social" src="images/icons/icons8-instagram-26.png">
            </a></li>
          <li><a href="mailto:vlasblauw@info.be">
              <img class="social"
                src="images/icons/email-envelope-outline-shape-with-rounded-corners_icon-icons.com_56530.png">
            </a></li>
        </ul>
      </div>
    </div>
  </div>

  <div class="buttons">
    <button id="prev-project" type="button" aria-label="Vorig project">← Previous</button>
    <button id="next-project" type="button" aria-label="Volgend project" style="padding-right: 15px;">Next →</button>
  </div>

  <div class="project-top">
  <div id="project-thumbnail" class="project-thumbnail">
    <div id= "thumb-wrap" class="thumb-wrap" aria-live="polite"></div>
  </div>

  <div id = "credits" class="credits">
    credits
  </div>

  <div class="project-header">
    <h2 id="project-title"></h2>
    <div id="year">2025</div>
  </div>
  <div id="tasks" class="project-tasks">
  </div>
  <div class="project-description">
    <p id="descriptionNL">description</p>
    <p id="descriptionEN" style="font-style: italic">description</p>
  </div>

  <hr>

  </div>

  <div id="project-gallery" class="project-gallery"></div>

  <div class="bottomnav">
    <div class="nav-container">
      <p>info@vlasblauw.be | +32491047057</p>
    </div>
  </div>

  <script>
    (async function () {
      const params = new URLSearchParams(location.search);
      const folder = params.get('folder');
      const titleElement = document.getElementById('project-title');
      const yearElement = document.getElementById('year');
      const descriptionNLElement = document.getElementById('descriptionNL');
      const descriptionENElement = document.getElementById('descriptionEN');
      const thumbnailElement = document.getElementById('project-thumbnail');
      const thumbnailImageElement = document.getElementById('thumb-wrap');
      const galleryElement = document.getElementById('project-gallery');
      const prevBtn = document.getElementById('prev-project');
      const nextBtn = document.getElementById('next-project');
      const creditsElement = document.getElementById('credits');
      const tasksElement = document.getElementById('tasks');

      if (!folder) {
        galleryElement.innerHTML = '<p>No project specified.</p>';
        return;
      }

      const decodedFolder = decodeURIComponent(folder);

      //Joins the path to form absolute path
      function joinPath(a, b) {
        return String(a).replace(/\/+$/, '') + '/' + String(b).replace(/^\/+/, '');
      }

      //Load full manifest
      let manifest = [];
      try {
        const res = await fetch('./projects.json', { cache: 'no-cache' });
        if (res.ok) manifest = await res.json();
      } catch (e) { manifest = []; }
      const manifestIndex = Array.isArray(manifest)
        ? manifest.findIndex(it =>
          it.title === decodedFolder)
        : -1;

      //Get the entry from manifest based on computed index  
      const entry = manifestIndex !== -1 && Array.isArray(manifest) ? manifest[manifestIndex] : null;

      //Setup previous and next buttons
      if (prevBtn && nextBtn) {
        if (manifestIndex > 0) {
          prevBtn.addEventListener('click', () => {
            const target = manifest[manifestIndex - 1];
            location.href = `project_thumbnail.html?folder=${encodeURIComponent(target.title)}`;
          });
        } else {
          prevBtn.addEventListener('click', () => {
            const target = manifest[manifest.length - 1];
            location.href = `project_thumbnail.html?folder=${encodeURIComponent(target.title)}`;
          });
        }
        if (manifestIndex !== -1 && manifestIndex < manifest.length - 1) {
          nextBtn.addEventListener('click', () => {
            const target = manifest[manifestIndex + 1];
            location.href = `project_thumbnail.html?folder=${encodeURIComponent(target.title)}`;
          });
        } else {
          nextBtn.addEventListener('click', () => {
            const target = manifest[0];
            location.href = `project_thumbnail.html?folder=${encodeURIComponent(target.title)}`;
          });
        }
      }

      //If no entry found in manifest display message
      if (!entry) {
        galleryElement.innerHTML = `<p style="font-style:italic;text-align:center; margin:100px auto auto;>Project "${decodedFolder}" niet gevonden in manifest.</p>`;
        return;
      }

      //Set title/year/description/images from json manifest if available
      //titleElement.textContent = entry.title;
      const titleText = String(entry.title);
          for (const ch of titleText) {
            const span = document.createElement('span');
            if (/\p{N}/u.test(ch)) { // number
              span.style.fontWeight = '200';
              span.textContent = ch;
            } else if (/\p{L}/u.test(ch)) { // letter
              span.style.fontWeight = '700';
              span.textContent = ch;
            } else { // punctuation/space/etc
              span.textContent = ch;
            }
            titleElement.appendChild(span);
          }
      yearElement.textContent = entry.year;
      descriptionNLElement.textContent = entry.description_nl;
      descriptionENElement.textContent = entry.description_en;
      creditsElement.textContent = entry.credits;
      tasksElement.innerHTML = entry.task;
      let images = entry.images;

      //Add project folder path to images if absolute path not specified
      images = images.map(img => {
        img = String(img || '').trim();
        const looksAbsolute = /^\/|^[a-zA-Z]+:\/\//.test(img);
        const hasProjectsPrefix = img.startsWith('projects/');
        if (looksAbsolute || hasProjectsPrefix) {
          return img.replace(/^\/+/, '');
        }
        const base = `projects/${entry.title}/`;
        return joinPath(base, img);
      });

      //If no images found for project display message
      if (!images.length) {
        galleryElement.innerHTML = '<p style="font-style:italic;text-align:center; margin:100px auto auto;">Geen afbeeldingen gevonden voor dit project.</p>';
        return;
      }

      let currentIndex = 0;

      //Render gallery excluding the currentIndex
      function renderGallery() {
        galleryElement.innerHTML = images.map((src, idx) => {
          if (idx === currentIndex) return '';
          const safe = String(src).replace(/^\/+/, '');
          return `<div class="gallery-item" data-index="${idx}"><img src="${safe}" alt=""></div>`;
        }).join('');
      }

      //Display image at given index in the thumbnail area
      function renderIndex(i) {
        currentIndex = ((i % images.length) + images.length) % images.length;
        const safe = String(images[currentIndex]).replace(/^\/+/, '');
        thumbnailImageElement.innerHTML = `<img src="${safe}" alt="">`;
        renderGallery();
        //Scroll the page so the thumbnail is at the top of the viewport
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }

      //Add image to thumbnail
      const src = joinPath(entry.href, entry.thumbnail);
      const safe = src.replace(/^\/+/, '');
      thumbnailImageElement.innerHTML = `<img src="${safe}" alt="">`;
      //Mark initial index if thumbnail matches one of images (initial thumbnail not necessarily first image)
      const matched = images.findIndex(p => p.replace(/^\/+/, '').endsWith(String(entry.thumbnail || '').replace(/^\/+/, '')));
      currentIndex = matched !== -1 ? matched : 0;
      renderIndex(currentIndex);

      // Add images to gallery, excluding the currently displayed thumbnail
      galleryElement.innerHTML = images.map((src, idx) => {
        if (idx === currentIndex) return ''; //Skip current thumbnail
        const safe = String(src).replace(/^\/+/, '');
        return `<div class="gallery-item" data-index="${idx}"><img src="${safe}" alt=""></div>`;
      }).join('');
    })();
  </script>
</body>

</html>