<!DOCTYPE html>
<html lang="nl">
<link href='https://fonts.googleapis.com/css?family=Roboto Flex' rel='stylesheet'>

<head>
  <meta charset="utf-8" />
  <title>Project</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .project-header {
      max-width: 1075px;
      margin: 20px auto;
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .project-gallery {
      max-width: 1075px;
      margin: 100px auto 0px auto;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .project-gallery img {
      max-width: 320px;
      width: 100%;
      height: auto;
      display: block;
    }

    .back {
      text-decoration: none;
      color: #1b2c3e;
      font-weight: 600;
      margin-right: 12px;
    }
  </style>
</head>

<body>
  <div class="topnav">
    <div class="nav-container">
      <div class="nav-left">
        <ul>
          <li><img class="logo" src="/images/logo_nowhites.jpg" alt="Vlasblauw Logo"></li>
          <li><a href="vlasblauw.html">vlasblauw</a></li>
          <li><a href="index.html">projecten</a></li>
          <li><a href="contact.html">contact</a></li>
        </ul>
      </div>
      <div class="nav-right">
        <ul>
          <li><a href="https://www.instagram.com/vlasblauw/">
              <img class="social" src="images/icons/icons8-instagram-26.png">
            </a></li>
        </ul>
      </div>
    </div>
  </div>

  <div id="project-gallery" class="project-gallery"></div>

  <div class="project-header">
    <h2 id="project-title">Project</h2>
    <div id="year">2025</div>
    <p id="description">description</p>
  </div>

  <div class="bottomnav">
    <div class="nav-container">
      <p>info@vlasblauw.be</p>
    </div>
  </div>

  <script>
    (async function () {
      const params = new URLSearchParams(location.search);
      const folder = params.get('folder');
      const titleElement = document.getElementById('project-title');
      const yearElement = document.getElementById('year');
      const descriptionElement = document.getElementById('description');
      const galleryElement = document.getElementById('project-gallery');

      if (!folder) {
        galleryElement.innerHTML = '<p>No project specified.</p>';
        return;
      }

      const decodedFolder = decodeURIComponent(folder);

      //Joins the path to form absolute path
      function joinPath(a, b) {
        return String(a).replace(/\/+$/, '') + '/' + String(b).replace(/^\/+/, '');
      }

      //Load projects.json and return the matching entry
      async function loadManifestEntry() {
        try {
          const res = await fetch('./projects.json', { cache: 'no-cache' });
          if (!res.ok) return null;
          const items = await res.json();
          if (!Array.isArray(items)) return null;
          const entry = items.find(it =>
            it.folder === decodedFolder ||
            it.title === decodedFolder ||
            (it.href && it.href.replace(/\/$/, '').endsWith(decodedFolder))
          );
          return entry || null;
        } catch (e) {
          return null;
        }
      }

      const entry = await loadManifestEntry();

      //If no entry found in manifest display message
      if (!entry) {
        galleryElement.innerHTML = `<p style="font-style:italic;text-align:center; margin:100px auto auto;>Project "${decodedFolder}" niet gevonden in manifest.</p>`;
        return;
      }

      //Set title/year/description/images from json manifest if available
      titleElement.textContent = entry.title;
      yearElement.textContent = entry.year;
      descriptionElement.textContent = entry.description;
      let images = entry.images;

      //Add project folder path to images if absolute path not specified
      images = images.map(img => {
        img = String(img || '').trim();
        const looksAbsolute = /^\/|^[a-zA-Z]+:\/\//.test(img);
        const hasProjectsPrefix = img.startsWith('projects/');
        if (looksAbsolute || hasProjectsPrefix) {
          return img.replace(/^\/+/, '');
        }
        const base = entry.href || `projects/${entry.folder}/`;
        return joinPath(base, img);
      });

      //If no images found for project display message
      if (!images.length) {
        galleryElement.innerHTML = '<p style="font-style:italic;text-align:center; margin:100px auto auto;">Geen afbeeldingen gevonden voor dit project.</p>';
        return;
      }

      //Add images to gallery
      galleryElement.innerHTML = images.map(src => {
        const safe = src.replace(/^\/+/, '');
        return `<div class="gallery-item"><img src="${safe}" alt=""></div>`;
      }).join('');
    })();
  </script>
</body>

</html>